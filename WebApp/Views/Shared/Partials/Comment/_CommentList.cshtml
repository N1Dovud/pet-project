@model CommentViewModel

<section class="comments-section">
    @if (Model.Comments != null && Model.Comments.Any())
    {
        <ul class="comments-list">
            @if (Model.IsOwner)
            {
                @foreach (var comment in Model.Comments)
                {
                    <li class="comment-item">
                        <div class="comment-content">
                            <p class="comment-text">@comment.Note</p>
                            <time class="comment-date" datetime="@comment.LastEditDateTime.ToString("yyyy-MM-ddTHH:mm:ss")">
                                @comment.LastEditDateTime.ToString("g")
                            </time>
                        </div>
                        <div class="comment-actions">
                            <button type="button" class="edit-comment-btn" data-task-id="@Model.TaskId" data-comment-id="@comment.Id" data-return-url="@Model.ReturnUrl">Edit</button>
                            <form method="post" class="delete-comment-form" action="delete-comment" style="display: inline;">
                                <input type="hidden" name="commentId" value="@comment.Id" />
                                <input type="hidden" name="taskId" value="@Model.TaskId" />
                                <input type="hidden" name="returnUrl" value="@Model.ReturnUrl" />
                                <button type="submit" onclick="return confirm('Delete this comment?')">&times;</button>
                            </form>
                        </div>
                    </li>
                }
            }
            else
            {
                @foreach (var comment in Model.Comments)
                {
                    <li class="comment-item">
                        <div class="comment-content">
                            <p class="comment-text">@comment.Note</p>
                            <time class="comment-date" datetime="@comment.LastEditDateTime.ToString("yyyy-MM-ddTHH:mm:ss")">
                                @comment.LastEditDateTime.ToString("g")
                            </time>
                        </div>
                    </li>
                }
            }
        </ul>
    }
    else
    {
        <p class="no-comments-message">No comments yet.</p>
    }

    @if (Model.IsOwner) {
        <form method="post" action="add-comment" class="add-comment-form">
            <textarea name="note" placeholder="Add a comment..." required rows="3"></textarea>
            <input type="hidden" name="returnUrl" value="@Model.ReturnUrl" />
            <input type="hidden" name="taskId" value="@Model.TaskId" />
            <button type="submit">Add Comment</button>
        </form>
    }
</section>